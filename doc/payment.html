[% TAGS <% %> %]
<h1>ONLINE PAYMENT ARCHITECTURE</h1>

<p>This document describes the architecture of Act's online payment subsystem.
This system defers the actual purchasing to a third party, usually a bank.
We allow for pluggable backends to target various online payment solutions.</p>
<p>Currently implemented backends are YEF, used by the YAPC::Europe Foundation,
and TPF, used by The Perl Foundation. Online payment funds end up in the
selected foundation's bank account. The foundation then forwards them back to the
organizers. Using either backend requires prior agreement between the organizers
and the relevant foundation.</p>
<p>YEF currently accepts payments in euros. TPF currently accepts payments in
US dollars.</p>
<p>There's also a Fake backend which simulates a purchase for testing purposes.</p>
<p>The system is configured from each conference's <code>conf/act.ini</code> configuration
file.</p>
<pre>  [payment]
  open        = 1
  type        = YEF</pre>

<p>Set <code>open</code> to 1 to enable, or to 0 to disable, the online payment system.
<code>type</code> should be set to the appropriate backend: <code>YEF</code>, <code>TPF</code> or <code>Fake</code>.</p>
<p>Let's now walk through the steps involved in a purchase.</p>
<ul>
<li>
<p>In her main page, a user is invited to purchase a ticket to the conference
if she's registered and hasn't yet paid.</p>
</li>
<li>
<p>Clicking the <code>purchase</code> button invokes <code>Act::Handler::User::Purchase</code>.
This fetches the prices from the database table and displays the
purchase form via <i>templates/user/purchase</i>. This template can be overriden
and customized on a per-conference basis.</p>
</li>
<li>
<p>When a purchase form with a valid price is submitted,  <code>Act::Handler::User::Purchase</code>
creates a new order in the database with a status of <code>init</code>.</p>
<p>We then call the plugged backend (<code>Act::Payment::Foo</code>) to create a form
which contains encrypted information about the purchase order. When this form
is submitted, the user is taken to the bank's web site.</p>
</li>
<li>
<p>The bank handles credit card input and validation, and offers a link back
to the user's main page in the conference.</p>
</li>
<li>
<p>Meanwhile, the bank sends us an HTTP request with the status of the purchase.</p>
</li>
</ul>
